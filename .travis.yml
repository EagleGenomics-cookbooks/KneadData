sudo: required
dist: trusty

addons:
  apt:
    sources:
    - chef-stable-trusty
    packages:
    - chefdk

install: echo "skip bundle install"

branches:
  only:
  - master

services: docker

env:
  global:
  - RUBYOPT="-W0"
  matrix:
  - CHEF_VERSION=current INSTANCE=default-ubuntu-1604

before_script:
- sudo iptables -L DOCKER || ( echo "DOCKER iptables chain missing" ; sudo iptables
  -N DOCKER )
- eval "$(/opt/chefdk/bin/chef shell-init bash)"
- chef gem install kitchen-docker
- "/opt/chefdk/bin/chef exec rake tests"

script:
- KITCHEN_LOCAL_YAML=.kitchen.docker.yml /opt/chefdk/embedded/bin/kitchen verify ${INSTANCE}

notifications:
  slack:
    secure: by6aYs36h48hqoFEBg6jX66VqWEYAypLZYXY/OFA0khg5CeOEEZi3Ao6lgNefh6LEoDAApRU82vGzE6HDvV3lk1oDCpYktgazrjNKtCdPXqfomTkHyWGpwCR6S6a7HMy25ZizI85NAcfQYJIoZb3rG16MlXHSMQ/dLXq28UiM8xx4OpHA7gTASMrhL7zsiQiPCtEQlwBjEES7BOIYc6aE3cealX/ZKMpubsiQZYPjbC6AVoFhlC3uMGW+FYcAUrQMlSp8leZmjr7/JP8d8lF6XpBoOBayZqykCYsg38odmBwnte42LrMkMGq4CgUqAxU3mdRFISqdoHXx8ukibueRQuyaKeqQE2J/nXVM3L95+Ac4U/9lxAQaUHPa0NAzWCQuC31moBw1dOQUjmGbjHs7sxB3z0RYMa9Mk/qiNQdMd4Jlr8pJD1ekb8xZ+7CqjbzRGOD9kvJ7luylqxBG2RTOW0LnWqBvwOEVh1lAPsKVxdnmO5D6/on+NoUOxFUg58PY2XQZKTbCzt5kLlXf5Z7Pj125S5r+jO9LCBkNVZz9TuTNdWnLcornDnpGKYz7ns82q22cZEDVuO7idj5DqMJp9wG7KoP2Bbmi8jBe2MKywMg5WQPxPdVk2tqa5NHYZYOacU+iuf78CAUcuxqjgbRjwSEGToEdNBCK5yDuionhDc=
  email:
    on_success: change
    on_failure: always
